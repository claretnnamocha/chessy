<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Ludo</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
            .container{
                
                width: 100%;
                
            }
            .box{
                width:60px;
                height: 60px;
                border: 2px solid #eee;
                float: left;
                margin: 5px;
            }
            .button{
                clear: both;
            }
            .red_pin{
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
                border-radius: 50px;
                background: red;
                margin: 15px;
                position: absolute;
            }
            .blue_pin{
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
                border-radius: 50px;
                background: blue;
                margin: 15px;
                position: absolute;
            }
            .green_pin{
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
                border-radius: 50px;
                background: green;
                margin: 15px;
                position: absolute;
            }
            .yellow_pin{
                width: 30px;
                height: 30px;
                border: 2px solid #fff;
                border-radius: 50px;
                background: yellow;
                margin: 15px;
                position: absolute;
            }
        </style>
    </head>
    <body>
        <span id="timer">Timer </span>
        <div id="points_v">Points</div>
        <div id="dice_value">
            Dice
        </div>
        <div class="button">
            <button id="new_player" style="float: left;">New Player</button>
            <button id="roll" style="float: left;">Roll</button>
            <select id="action" style="float: left;">
                <option value="move">move</option>
                <option value="remove">remove</option>
                <option value="save">save</option>
            </select>
            <select id="type" style="float: left;">
                <option value="block">block</option>
                <option value="pin">pin</option>
            </select>
            <select id="block_action" style="display: block;float: left;">
                <option value="wall">wall</option>
                <option value="trap">trap</option>
            </select>
            <button id="use_point" style="float: left;">Use Point</button>
            <!-- <button id="roll2">Roll x2</button> -->
        </div>
        <div style="clear: both;"></div>
        <div class="container">
            <div id="A1" class="box"></div>
            <div id="A2" class="box"></div>
            <div id="A3" class="box"></div>
            <div id="A4" class="box"></div>
            <div id="A5" class="box"></div>
            <div id="A6" class="box"></div>
            <div id="A7" class="box"></div>
            <div id="A8" class="box"></div>
            <div id="A9" class="box"></div>
            <div id="A10" class="box"></div>
            <div id="A11" class="box"></div>
            <div id="A12" class="box"></div>
            <div id="A13" class="box"></div>
            <div id="A14" class="box"></div>
            
            <div style="clear: both"></div>
            <div id="B1" class="box"></div>
            <div id="B2" class="box"></div>
            <div id="B3" class="box"></div>
            <div id="B4" class="box"></div>
            <div id="B5" class="box"></div>
            <div id="B6" class="box"></div>
            <div id="B7" class="box"></div>
            <div id="B8" class="box"></div>
            <div id="B9" class="box"></div>
            <div id="B10" class="box"></div>
            <div id="B11" class="box"></div>
            <div id="B12" class="box"></div>
            <div id="B13" class="box"></div>
            <div id="B14" class="box"></div>

            <div style="clear: both"></div>
            <div id="C1" class="box"></div>
            <div id="C2" class="box"></div>
            <div id="C3" class="box"></div>
            <div id="C4" class="box"></div>
            <div id="C5" class="box"></div>
            <div id="C6" class="box"></div>
            <div id="C7" class="box"></div>
            <div id="C8" class="box"></div>
            <div id="C9" class="box"></div>
            <div id="C10" class="box"></div>
            <div id="C11" class="box"></div>
            <div id="C12" class="box"></div>
            <div id="C13" class="box"></div>
            <div id="C14" class="box"></div>

            <div style="clear: both"></div>
            <div id="D1" class="box"></div>
            <div id="D2" class="box"></div>
            <div id="D3" class="box"></div>
            <div id="D4" class="box"></div>
            <div id="D5" class="box"></div>
            <div id="D6" class="box"></div>
            <div id="D7" class="box"></div>
            <div id="D8" class="box"></div>
            <div id="D9" class="box"></div>
            <div id="D10" class="box"></div>
            <div id="D11" class="box"></div>
            <div id="D12" class="box"></div>
            <div id="D13" class="box"></div>
            <div id="D14" class="box"></div>
            <div style="clear: both"></div>
        </div>
        
        <div id="base_classes" style="position: relative;margin-top: 0px;">
            <div id="red_pins" style="float: left">
                <div class='red_pin' id="red_pin0" style="top: 0px;" onclick="pin_tapped(this)"></div>
                <div class='red_pin' id="red_pin1" style="top: 50px;" onclick="pin_tapped(this)"></div>
                <div class='red_pin' id="red_pin2" style="top: 100px;" onclick="pin_tapped(this)"></div>
                <div class='red_pin' id="red_pin3" style="top: 150px;" onclick="pin_tapped(this)"></div>
            </div>
            
            <div id="blue_pins" style="float: left">
                <div class='blue_pin' id="blue_pin4" style="top: 0px; left: 50px;" onclick="pin_tapped(this)"></div>
                <div class='blue_pin' id="blue_pin5" style="top: 50px; left: 50px;" onclick="pin_tapped(this)"></div>
                <div class='blue_pin' id="blue_pin6" style="top: 100px; left: 50px;" onclick="pin_tapped(this)"></div>
                <div class='blue_pin' id="blue_pin7" style="top: 150px; left: 50px;" onclick="pin_tapped(this)"></div>
            </div>
            <div id="green_pins" style="float: left">
                <div class='green_pin' id="green_pin8" style="top: 0px; left: 100px;" onclick="pin_tapped(this)"></div>
                <div class='green_pin' id="green_pin9" style="top: 50px; left: 100px;" onclick="pin_tapped(this)"></div>
                <div class='green_pin' id="green_pin10" style="top: 100px; left: 100px;" onclick="pin_tapped(this)"></div>
                <div class='green_pin' id="green_pin11" style="top: 150px; left: 100px;" onclick="pin_tapped(this)"></div>
            </div>
            <div id="yellow_pins" style="float: left">
                <div class='yellow_pin' id="yellow_pin12"  style="top: 0px; left: 150px;" onclick="pin_tapped(this)"></div>
                <div class='yellow_pin' id="yellow_pin13" style="top: 50px; left: 150px;" onclick="pin_tapped(this)"></div>
                <div class='yellow_pin' id="yellow_pin14" style="top: 100px; left: 150px;" onclick="pin_tapped(this)"></div>
                <div class='yellow_pin' id="yellow_pin15" style="top: 150px; left: 150px;" onclick="pin_tapped(this)"></div>
            </div>
        </div>
        

    </body>
</html>
<script src="scripts/jquery-3.4.1.js"></script>
<script src="scripts/generator.js"></script>
<script src="scripts/move.js"></script>
<script src="scripts/pins.js"></script>
<script src="scripts/players.js"></script>
<script src="scripts/dice.js"></script>
<script src="scripts/ui.js"></script>
<script src="scripts/points.js"></script>
<!-- always import constants last -->
<script src="scripts/constants.js"></script>
<script>
$(document).ready(function() {
    let container = $(".container");
    for (let i = 0; i < container.children().length; i++) {
        // container.children()[i].attr("id");
        // console.log(("#" + container.children()[i].id))
        if (container.children()[i].id != '') {
            $("#" + container.children()[i].id).on('click', () => {
                // alert("")
                GeneratorObject.activate_block(container.children()[i].id, player_id);
            })
            // console.log()
        } 
    }

    let action_type = $("#type");
    let block_action = $("#block_action");
    action_type.on("change", function() {
        if (action_type.val() == "pin") {
            block_action.css("display","none");
        }
        else {
            block_action.css("display","block");
        }
    });

    
});

$("#new_player").click(function(){
    //add a new player
    let new_player_data = player_info[player_counter];
    player_id = player_counter;
    
    // add players
    
    playerObject.new(player_counter, player_id, new_player_data , bases.length, pins_per_player, bases[player_counter], base_pins[player_counter])
    //add a new pin for the player
    // pn1 = new Pins(pl1.get(player_id));
    player_counter++;   
});

function pin_tapped(pin) {
    //activate pin
    
    GeneratorObject.PinObject.activate(pin.id);
    // let parent_id = GeneratorObject.UIObject.get_pin_parent(pin.id);
    // GeneratorObject.UIObject.remove_from_base(parent_id, pin.id);
}

$("#roll").click(function(){
    //testing start
    player_id = GeneratorObject.get_active_player();
    let p_player = playerObject.get(player_id);

    switch(p_player.game.valid) {
        case Postive:
            let die1 = Math.floor(Math.random() * 6) + 1;
            let die2 = Math.floor(Math.random() * 6) + 1;
            document.getElementById("dice_value").innerHTML = "Dice: Die 1: " + die1 + " ||Die 2: " + die2 + " ||player id: " + player_id;
            if (player_id == 0) {
                die1 = 15; die2 = 1;
            }
            else if (player_id == 1) {
                die1 = 1; die2 = 1;
            }
            let max_secs = 6;
            let counter = setInterval(() => {
                document.getElementById("timer").innerHTML = "Timer: " + max_secs + "s";
                max_secs--;
            }, 1000);

            setTimeout(() => {
                clearInterval(counter);
                
                //testing
                let action = $("#action").val();
                //testing/
                switch(action) {
                    case "move": 
                        let active_pin = GeneratorObject.PinObject.get(player_id);
                        pin = UIObject.pin_classes[p_player.number];
                        activate_pin(pin, active_pin);
                        remove_from_base(pin_id, active_pin);
                        let holder = container.children().children(pin_id);
                        console.log("holder", holder);
                        let default_pin = active_pin.game.start_block;
                        
                        // let current_box_id = holder.length == 0 ? default_pin : holder.parent().attr("id").replace("#");
                        
                        // current box on the board logic
                        let current = holder.length == 0 ? default_pin : holder.parent().attr("id").replace("#");
                        console.log("ludo 191", current);
                        let current_base = (current == default_pin) ? bases[p_player.number] : holder.parent().attr("id").replace("#").substring(0,1);
                        
                        
                        console.log("Total of Dice: " + (die1 + die2));
                        
                        let res = MovementObject.move(current, die1, die2, current_base, no_per_base, bases, GeneratorObject.blocks, p_player);
                        console.log(JSON.stringify(res))
                        current = res.point;
                        current_base = res.base;
                        UIObject.ui_move(pin_html, pin_id, container, res.starting_point, (die1 + die2), no_per_base, res.starting_base, bases, GeneratorObject, p_player)
                        break;
                    case "remove":
                        if (die1 == 6 || die2 == 6) {
                            activate_pin(pin_id, activate_pin);
                            remove_from_base(pin_id);
                            break;
                        }
                        alert("No six");
                        break;
                    case "save":
                        // console.log(JSON.stringify(PointSaver))
                        PointSaver[player_id] = { total: PointSaver[player_id].total + die1 + die2 };
                        p_player.game.points = p_player.game.points + (die1 + die2)
                        
                        //testing start
                        update_ui_points();
                        //testing end
                        
                        // console.log(JSON.stringify(PointSaver))
                        break;
                    default:
                        // no valid action selected
                        break;    
                }
                GeneratorObject.set_active_player();
            }, 6000);
            break;
        default:
            // player not valid
            console.log(messages.INVALID_PLAYER);
            break;
    }
    
    
});

$("#use_point").click(function() {
    
    // let p_player = playerObject.get(player_id);
    let point_type = $("#type").val();
    if (point_type == "pin") {
        let active_pin = GeneratorObject.PinObject.get(player_id);
        if (active_pin != null) {
            PointsObject.use(point_type, "armour", player_id, active_pin.game.pin_id);
        }
        else {
            UIObject.display_message(messages.ACTIVATE_PIN);
        }
        
    }
    else if (point_type == "block") {
        let block_action = $("#block_type").val();
        let active_block = GeneratorObject.get();
        if (active_block != undefined) {
            PointsObject.use(point_type, block_action, player_id, undefined, active_block.id);
        }
        
        
    }
    
});

function activate_pin(pin, active_pin) {
    try {
        setPinInfo(pin, active_pin.game.pin_id);

    }
    catch(error) {
        UIObject.display_message(messages.ACTIVATE_PIN)
        return;
    }
}

function remove_from_base(pin_id, active_pin) {
    if (active_pin != null) {
        let parent_id = GeneratorObject.UIObject.get_pin_parent(pin_id);
    
        if (active_pin.game.position === GeneratorObject.PinObject.pin_position.base) 
        {   
            GeneratorObject.UIObject.remove_from_base(parent_id, pin_id);
        }
    }
    
}

function update_ui_points() {
    // testing
    let ddict = {}
    let keys = Object.keys(PlayerObject.players);
    keys.forEach(element => {
        // console.log(PlayerObject.players[element].game.points)
        ddict[element] = PlayerObject.players[element].game.points
    });
    document.getElementById("points_v").innerHTML = "Points: " + JSON.stringify(ddict);
    //testing ends
}



</script>